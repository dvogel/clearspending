{% extends "base.html" %}
{% block scripts %}
    {{ block.super }}
    <script src="{{ STATIC_URL }}scripts/d3.v2.js"></script>
    <script src="{{ STATIC_URL }}scripts/charts.js"></script>
    <style type="text/css">
        .cell {
            position: absolute;
            border: solid 1px white;
            font: 8.9px sans-serif;
            line-height: 10px;
            overflow: hidden;
            position: absolute;
            text-indent: 2px;
        }
        .cell.unknown {
        }
        .cell.category {
            display: none;
        }
        div.chart-loading {
            position: absolute;
            width: 100%;
            top: 50%;
            height: 48px;
            margin-top: -24px;
            font-weight: bold;
            color: #6C6764;
            font-size: 24px;
            vertical-align: middle;
            text-align: center;
        }
        div.chart-loading div {
            display: inline-block;
            margin: 0 auto;
        }
        #chart-con {
            position: relative;
            width: 840px;
            margin: auto auto;
        }
        #status-con {
            position: relative;
            width: 840px;
            height: 3em;
        }
        #status, #program-description {
            font-weight: bold;
        }
        #program-description {
            display: none;
        }
        #legend {
            display: block;
            vertical-align: top;
            float: right;
            background: none rgb(255, 255, 255);
            border-radius: 7px;
            -moz-border-radius: 7px;
            border-color: black;
            border-width: 1px;
            border-style: solid;
            padding: 1em;
            margin: 0 1em 1em 1em;
        }
        span.swatch {
            display: inline-block;
            width: 1em;
            height: 1em;
            overflow: hidden;
        }
        .perfect {
            background: none rgb(0, 200, 0);
        }
        .fail {
            background: none rgb(240, 59, 32);
        }
        .pass {
            background: none rgb(255, 237, 160);
            background: none #faca2c;
        }
        .blind {
            background: none transparent;
        }
        .bg-shell.perfect {
            background: none transparent;
        }
        .bg-shell.fail {
            background: none transparent;
        }
        .bg-shell.pass {
            background: none transparent;
        }
        .bg-shell.blind, span.swatch.blind {
            background: url(../static/images/nonreportingbg.png) repeat top left transparent;
        }
        .blind {
            background: none transparent;
        }
        .bg-shell.perfect {
            background: none transparent;
        }
        .bg-shell.fail {
            background: none transparent;
        }
        .bg-shell.pass {
            background: none transparent;
        }
        .bg-shell.blind {
            background: url(../static/images/nonreportingbg.png) repeat top left transparent;
        }
        div#chart-buttons {
            float: right;
        }
        span.fiscal_year_chooser {
            text-align: right;
            color: #68A31D;
            margin: 0 0.5em;
            cursor: pointer;
        }
        span.fiscal_year_chooser:hover {
        }
        span.fiscal_year_chooser.selected {
            color: #68A31D;
            font-weight: bold;
        }
        span.title {
            display: inline;
            float: left;
            font-weight: bold;
            font-size: 14px;
        }
    </style>
{% endblock %}
{% block bodyclass %}consistency{% endblock bodyclass %}
{% block content %}
<div id="pageMain">
<h3>Consistency Results</h3>
<p>While it would be ideal to measure the accuracy of the grants data in USASpending.gov, that is not possible on a large scale because of the opaqueness of the path from budget appropriations in the legislative branch to obligations in the executive branch. Essentially, agencies take prose descriptions of appropriations and divide them into CFDA programs. Because that process can vary by agency and isn't public, we can't know exactly what the amount in USASpending.gov should be. Because of this, we compare the yearly aggregates for each CFDA program in USASpending with the yearly estimates provided in the CFDA online catalog. Essentially, we are comparing two different sources of government reporting of financial obligations that should be within a reasonable range of each other. If there is greater than a 50% difference, then we mark it as failing.

        <h5 class="table-header">Failed Dollars, Consistency Metric Only, By Fiscal Year</h5>
        <table class="results-table">
            <thead>
                <tr><th>Fiscal Year</th><th>Inconsistent Dollars</th><th>Total Dollars</th><th>% Inconsistent</th></tr>
            </thead>
            <tbody>
                <tr><td>2009</td><td>$513,684,900,256</td><td>$1,625,257,115,439</td><td>31.6%</td></tr>
                <tr class="even"><td>2010</td><td>$887,303,764,481</td><td>$1,437,032,472,474</td><td>61.8%</td></tr>
                <tr><td>2011</td><td>$1,135,588,492,032</td><td>$1,639,826,026,452</td><td>69.3%</td></tr>
            </tbody>
        </table>

        <p> As illustrated in the table above, the amount failing due to inconsistency has increased over the past few years. This is largely due to several Medicare insurance programs that had been reporting data to USASpending.gov, but stopped reporting altogether in FY 2010. It's not clear why these programs stopped reporting, but the public database for the Department of Health and Human Services (<a href="http://taggs.hhs.gov">TAGGS</a>) also does not have this spending reported. Requests for comments from agency officials were not returned.</p>

<p> A troubling trend between 2009 and 2011 is the increasing amount of completely unreported obligations. It is sometimes expected for there to be a mismatch between the CFDA estimates and the USASpending.gov obligations. For example, In 2009 Unemployment Insurance was drastically underestimated by the CFDA, due to the deteriorating conditions of the economy later in the year which prompted an expansion of the program. However, when a program reports nothing at all to USASpending.gov, it's an indication that the reporting process has completely broken down. Moreover, there exists no oversight process for identifying these programs and fixing their reporting. The visualization below shows the overall size and scope of the total nonreporting dollars (in black) over time. 
    <div id="chart-con">
        <span class="title">Consistency of Federal Direct Assistance Reporting</span>
        <div id="chart-buttons">
            {% for fy in FISCAL_YEARS %}
            <span class="fiscal_year_chooser">{{ fy }}</span>
            {% endfor %}
        </div>

        <div class="clear"></div>

        <div id="chart">
        </div>

        <div class="clear"></div>
        <div id="status-con">
            <div id="status">
                Move your cursor over the diagram for details on each federal spending program.
            </div>
            <div id="program-description">
            </div>
        </div>
    </div>
        <div class="clear"></div>


    <div id="legend">
        <span id="legend-title">Legend</span> <br>
        <span class="swatch blind" id="blind-swatch">&nbsp;</span> Non-reporting programs <br>
        <span class="swatch fail" id="bad-swatch">&nbsp;</span> Failing programs <br>
        <span class="swatch pass" id="ok-swatch">&nbsp;</span> Passing programs <br>
        <span class="swatch perfect" id="perfect-swatch">&nbsp;</span> Best programs <br>
    </div>

    <p>
    In the diagram you can see a rectangle for each spending program, sized relative to the amount of spending it represents. The black area represents programs that completely fail to report their spending to the FAADS. The yellow area represents programs for which the deviation between the CFDA and the FAADS is less than 50%, while programs with more than a 50% deviation represented by red.
    </p>

</div>
{% endblock %}

